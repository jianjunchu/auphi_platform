<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aofei.depend.mapper.LogJobDependenciesMapper">



    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.aofei.depend.entity.LogJobDependencies">
        <id column="LOG_ID" property="logId" />
        <result column="SCHED_NAME" property="schedName" />
        <result column="JOB_NAME" property="jobName" />
        <result column="JOB_GROUP" property="jobGroup" />
        <result column="EXECUTE_JOB_NAME" property="executeJobName" />
        <result column="EXECUTE_JOB_GROUP" property="executeJobGroup" />
        <result column="STARTDATE" property="startdate" />
        <result column="ENDDATE" property="enddate" />
        <result column="JOB_TYPE" property="jobType" />
        <result column="CHANNEL_ID" property="channelId" />
        <result column="ERRORS" property="errors" />
        <result column="STATUS" property="status" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
          a.LOG_ID AS logId
        , a.SCHED_NAME AS schedName
        , a.JOB_NAME AS jobName
        , a.JOB_GROUP AS jobGroup
        , a.EXECUTE_JOB_NAME AS executeJobName
        , a.EXECUTE_JOB_GROUP AS executeJobGroup
        , a.STARTDATE AS startdate
        , a.ENDDATE AS enddate
        , a.JOB_TYPE AS jobType
        , a.CHANNEL_ID AS channelId
        , ERRORS AS errors
        , STATUS AS status
    </sql>



    <select id="findList"  resultType="com.aofei.depend.entity.LogJobDependencies">
        select
        <include refid="Base_Column_List"/>
        , b.GROUP_NAME AS jobGroupName
        , exe.GROUP_NAME AS executeJobGroupName

        from LOG_JOB_DEPENDENCIES a
        JOIN QRTZ_GROUP b on a.JOB_GROUP = b.ID_GROUP
        JOIN QRTZ_GROUP exe on a.JOB_GROUP = exe.ID_GROUP

        <where>
            <if test="jobGroup != null and jobGroup!='' ">
                AND  a.JOB_GROUP = #{jobGroup}
            </if>


            <if test="jobName != null and jobName!='' ">
                AND  a.JOB_NAME  like '%${jobName}%'
            </if>

            <if test="searchtime != null and searchtime == 'start' ">
                AND  (a.STARTDATE between #{startTime} and #{endTime})
            </if>

            <if test="searchtime != null and searchtime == 'end' ">
                AND  (a.ENDDATE between #{startTime} and #{endTime})
            </if>

        </where>
    </select>
</mapper>
